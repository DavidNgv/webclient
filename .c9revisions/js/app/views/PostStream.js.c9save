{"ts":1346894325033,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"/*\n * Copyright 2012 Denis Washington <denisw@online.de>\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\ndefine(function(require) {\n  var $ = require('jquery');\n  var _ = require('underscore');\n  var api = require('app/util/api');\n  var avatarFallback = require('app/util/avatarFallback');\n  var Backbone = require('backbone');\n  var template = require('text!templates/PostStream.html');\n\n  // Thanks to John Gruber:\n  // http://daringfireball.net/2010/07/improved_regex_for_matching_urls\n  var URL_REGEX = /\\b((?:[a-z][\\w-]+:(?:\\/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}\\/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))/g;\n\n  var PostStream = Backbone.View.extend({\n    tagName: 'div',\n    className: 'post-stream',\n\n    initialize: function() {\n      this.model.bind('reset', this.render, this);\n      this.model.bind('add', this.render, this);\n      this.model.bind('remove', this.render, this);\n      this._renderSpinningIcon();\n    },\n\n    render: function() {\n      this.$el.html(_.template(template, {\n        threads: this.model.byThread(),\n        avatarUrlFunc: api.avatarUrl,\n        linkUrlsFunc: this._linkUrls\n      }));\n      this._setupAvatarFallbacks();\n    },\n\n    _linkUrls: function(content) {\n      content = $('<div/>').text(content).html();\n      return content.replace(URL_REGEX, '<a href=\"$&\" target=\"_blank\">$&</a>');\n    },\n\n    _setupAvatarFallbacks: function() {\n      var toplevelAvatars = this.$('.thread > header .avatar');\n      var commentAvatars = this.$('.comment .avatar');\n      avatarFallback(toplevelAvatars, 'personal', 48);\n      avatarFallback(commentAvatars, 'personal', 32);\n    },\n\n    _renderSpinningIcon: function() {\n      var icon =\n        $('<div class=\"loading\"><img src=\"img/bc-icon.png\"></div>');\n\n      this.$el.html(icon);\n      this._startSpinning(icon);\n    },\n\n    _startSpinning: function(icon) {\n      var rotation = 0;\n\n      var spin = setInterval(function() {\n        var rotate = 'rotate(' + rotation + 'deg)';\n        icon.find('img').css({\n          'transform': rotate,\n          '-moz-transform': rotate,\n          '-webkit-transform': rotate\n        });\n        rotation = (rotation + 10) % 360;\n      }, 50);\n\n      this.model.on('reset', function() {\n        clearTimeout(spin);\n      });\n    }\n  });\n\n  return PostStream;\n});\n"]],"start1":0,"start2":0,"length1":0,"length2":2901}]],"length":2901}
{"contributors":[],"silentsave":false,"ts":1346894354897,"patch":[[{"diffs":[[0,"/*"],[1,"\r"],[0,"\n * Copy"]],"start1":0,"start2":0,"length1":10,"length2":11},{"diffs":[[0,"line.de>"],[1,"\r"],[0,"\n *"],[1,"\r"],[0,"\n * Lice"]],"start1":49,"start2":49,"length1":19,"length2":21},{"diffs":[[0,"cense\");"],[1,"\r"],[0,"\n * you "]],"start1":121,"start2":121,"length1":16,"length2":17},{"diffs":[[0,"License."],[1,"\r"],[0,"\n * You "]],"start1":190,"start2":190,"length1":16,"length2":17},{"diffs":[[0,"cense at"],[1,"\r"],[0,"\n *"],[1,"\r"],[0,"\n * http"]],"start1":234,"start2":234,"length1":19,"length2":21},{"diffs":[[0,"ENSE-2.0"],[1,"\r"],[0,"\n *"],[1,"\r"],[0,"\n * Unle"]],"start1":285,"start2":285,"length1":19,"length2":21},{"diffs":[[0,"software"],[1,"\r"],[0,"\n * dist"]],"start1":361,"start2":361,"length1":16,"length2":17},{"diffs":[[0,"\" BASIS,"],[1,"\r"],[0,"\n * WITH"]],"start1":431,"start2":431,"length1":16,"length2":17},{"diffs":[[0,"implied."],[1,"\r"],[0,"\n * See "]],"start1":508,"start2":508,"length1":16,"length2":17},{"diffs":[[0,"ions and"],[1,"\r"],[0,"\n * limi"]],"start1":580,"start2":580,"length1":16,"length2":17},{"diffs":[[0,"nse."],[1,"\r"],[0,"\n */"],[-1,"\n"],[1,"\r\n\r"],[0,"\ndef"]],"start1":619,"start2":619,"length1":13,"length2":16},{"diffs":[[0,"quire) {"],[1,"\r"],[0,"\n  var $"]],"start1":650,"start2":650,"length1":16,"length2":17},{"diffs":[[0,"query');"],[1,"\r\n  var embedly = require('jquery.embedly');\r"],[0,"\n  var _"]],"start1":680,"start2":680,"length1":16,"length2":61},{"diffs":[[0,"nderscore');"],[1,"\r"],[0,"\n  var api ="]],"start1":754,"start2":754,"length1":24,"length2":25},{"diffs":[[0,"l/api');"],[1,"\r"],[0,"\n  var a"]],"start1":796,"start2":796,"length1":16,"length2":17},{"diffs":[[0,"lback');"],[1,"\r"],[0,"\n  var B"]],"start1":856,"start2":856,"length1":16,"length2":17},{"diffs":[[0,"kbone');"],[1,"\r"],[0,"\n  var t"]],"start1":895,"start2":895,"length1":16,"length2":17},{"diffs":[[0,".html');"],[-1,"\n"],[1,"\r\n  \r\n  $.embedly.defaults['key'] = '55bafac9655742c1af02b11cb0bd08e4';\r\n\r"],[0,"\n  // Th"]],"start1":956,"start2":956,"length1":17,"length2":90},{"diffs":[[0," Gruber:"],[1,"\r"],[0,"\n  // ht"]],"start1":1058,"start2":1058,"length1":16,"length2":17},{"diffs":[[0,"ing_urls"],[1,"\r"],[0,"\n  var U"]],"start1":1131,"start2":1131,"length1":16,"length2":17},{"diffs":[[0,"‘’]))/g;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  var P"]],"start1":1357,"start2":1357,"length1":17,"length2":19},{"diffs":[[0,"extend({"],[1,"\r"],[0,"\n    tag"]],"start1":1402,"start2":1402,"length1":16,"length2":17},{"diffs":[[0,": 'div',"],[1,"\r"],[0,"\n    cla"]],"start1":1423,"start2":1423,"length1":16,"length2":17},{"diffs":[[0,"stream',"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    ini"]],"start1":1454,"start2":1454,"length1":17,"length2":19},{"diffs":[[0,"ze: function() {"],[1,"\r"],[0,"\n      this.mode"]],"start1":1478,"start2":1478,"length1":32,"length2":33},{"diffs":[[0,"s.render, this);"],[1,"\r"],[0,"\n      this.mode"]],"start1":1530,"start2":1530,"length1":32,"length2":33},{"diffs":[[0,"s.render, this);"],[1,"\r"],[0,"\n      this.mode"]],"start1":1580,"start2":1580,"length1":32,"length2":33},{"diffs":[[0,", this);"],[1,"\r"],[0,"\n      t"]],"start1":1641,"start2":1641,"length1":16,"length2":17},{"diffs":[[0,"gIcon();"],[1,"\r"],[0,"\n    },"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    ren"]],"start1":1676,"start2":1676,"length1":24,"length2":27},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      this."]],"start1":1708,"start2":1708,"length1":24,"length2":25},{"diffs":[[0,"plate, {"],[1,"\r"],[0,"\n       "]],"start1":1756,"start2":1756,"length1":16,"length2":17},{"diffs":[[0,"hread(),"],[1,"\r"],[0,"\n       "]],"start1":1797,"start2":1797,"length1":16,"length2":17},{"diffs":[[0,"atarUrl,"],[1,"\r"],[0,"\n       "]],"start1":1836,"start2":1836,"length1":16,"length2":17},{"diffs":[[0,"linkUrls"],[1,"\r"],[0,"\n      }"]],"start1":1874,"start2":1874,"length1":16,"length2":17},{"diffs":[[0,"    }));"],[1,"\r"],[0,"\n      t"]],"start1":1886,"start2":1886,"length1":16,"length2":17},{"diffs":[[0,"backs();"],[1,"\r\n      $(this).embedly();\r"],[0,"\n    },"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    _li"]],"start1":1923,"start2":1923,"length1":24,"length2":53},{"diffs":[[0,"ntent) {"],[1,"\r"],[0,"\n      c"]],"start1":1995,"start2":1995,"length1":16,"length2":17},{"diffs":[[0,".html();"],[1,"\r"],[0,"\n      r"]],"start1":2046,"start2":2046,"length1":16,"length2":17},{"diffs":[[0,"&</a>');"],[1,"\r"],[0,"\n    },"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    _se"]],"start1":2127,"start2":2127,"length1":24,"length2":27},{"diffs":[[0,"ks: function() {"],[1,"\r"],[0,"\n      var tople"]],"start1":2170,"start2":2170,"length1":32,"length2":33},{"diffs":[[0,"r .avatar');"],[1,"\r"],[0,"\n      var c"]],"start1":2239,"start2":2239,"length1":24,"length2":25},{"diffs":[[0,"vatar');"],[1,"\r"],[0,"\n      a"]],"start1":2299,"start2":2299,"length1":16,"length2":17},{"diffs":[[0,"l', 48);"],[1,"\r"],[0,"\n      a"]],"start1":2355,"start2":2355,"length1":16,"length2":17},{"diffs":[[0,"l', 32);"],[1,"\r"],[0,"\n    },"],[-1,"\n"],[1,"\r\n\r"],[0,"\n    _re"]],"start1":2410,"start2":2410,"length1":24,"length2":27},{"diffs":[[0,"function() {"],[1,"\r"],[0,"\n      var i"]],"start1":2455,"start2":2455,"length1":24,"length2":25},{"diffs":[[0,"r icon ="],[1,"\r"],[0,"\n       "]],"start1":2477,"start2":2477,"length1":16,"length2":17},{"diffs":[[0,"/div>');"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      t"]],"start1":2547,"start2":2547,"length1":17,"length2":19},{"diffs":[[0,".html(icon);"],[1,"\r"],[0,"\n      this."]],"start1":2573,"start2":2573,"length1":24,"length2":25},{"diffs":[[0,"on);"],[1,"\r"],[0,"\n    },"],[-1,"\n"],[1,"\r\n\r"],[0,"\n   "]],"start1":2615,"start2":2615,"length1":16,"length2":19},{"diffs":[[0,"(icon) {"],[1,"\r"],[0,"\n      v"]],"start1":2659,"start2":2659,"length1":16,"length2":17},{"diffs":[[0,"ion = 0;"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      v"]],"start1":2684,"start2":2684,"length1":17,"length2":19},{"diffs":[[0,"val(function() {"],[1,"\r"],[0,"\n        var rot"]],"start1":2721,"start2":2721,"length1":32,"length2":33},{"diffs":[[0," 'deg)';"],[1,"\r"],[0,"\n       "]],"start1":2782,"start2":2782,"length1":16,"length2":17},{"diffs":[[0,"').css({"],[1,"\r"],[0,"\n       "]],"start1":2814,"start2":2814,"length1":16,"length2":17},{"diffs":[[0,"nsform': rotate,"],[1,"\r"],[0,"\n          '-moz"]],"start1":2838,"start2":2838,"length1":32,"length2":33},{"diffs":[[0," rotate,"],[1,"\r"],[0,"\n       "]],"start1":2883,"start2":2883,"length1":16,"length2":17},{"diffs":[[0,": rotate"],[1,"\r"],[0,"\n       "]],"start1":2922,"start2":2922,"length1":16,"length2":17},{"diffs":[[0,"\n        });"],[1,"\r"],[0,"\n        rot"]],"start1":2931,"start2":2931,"length1":24,"length2":25},{"diffs":[[0,") % 360;"],[1,"\r"],[0,"\n      }"]],"start1":2978,"start2":2978,"length1":16,"length2":17},{"diffs":[[0," }, 50);"],[-1,"\n"],[1,"\r\n\r"],[0,"\n      t"]],"start1":2993,"start2":2993,"length1":17,"length2":19},{"diffs":[[0,"tion() {"],[1,"\r"],[0,"\n       "]],"start1":3038,"start2":3038,"length1":16,"length2":17},{"diffs":[[0,"t(spin);"],[1,"\r"],[0,"\n      }"]],"start1":3067,"start2":3067,"length1":16,"length2":17},{"diffs":[[0," });"],[1,"\r"],[0,"\n    }"],[1,"\r"],[0,"\n  });"],[-1,"\n"],[1,"\r\n\r"],[0,"\n  r"]],"start1":3082,"start2":3082,"length1":21,"length2":25},{"diffs":[[0,"eam;"],[1,"\r"],[0,"\n});"],[1,"\r"],[0,"\n"]],"start1":3120,"start2":3120,"length1":9,"length2":11}]],"length":3131,"saved":false}
{"ts":1346894452917,"patch":[[{"diffs":[[0,";\r\n "],[-1," var embedly ="],[0," req"]],"start1":687,"start2":687,"length1":22,"length2":8}]],"length":3117,"saved":false}
